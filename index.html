<!DOCTYPE html>
<html lang="ru" data-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="–®–∞—Ö–º–∞—Ç–Ω—ã–π —Ç—Ä–µ–Ω–∞–∂–µ—Ä –¥–ª—è —Ä–∞–∑–≤–∏—Ç–∏—è —Ç–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑—Ä–µ–Ω–∏—è. –ù–∞—Ö–æ–¥–∏ —à–∞—Ö–∏ –∏ –≤–∑—è—Ç–∏—è!">
    <title>Chess Vision Trainer</title>
    <meta name="theme-color" content="#1d232a">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="assets/icons/icon-192.png">

    <!-- Generic Chess Favicon -->
    <link rel="icon" href="https://upload.wikimedia.org/wikipedia/commons/c/c3/Chess_klt45.svg" type="image/svg+xml">

    <!-- Tailwind CSS & DaisyUI -->
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.6.0/dist/full.min.css" rel="stylesheet" type="text/css" />
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!-- Google Fonts: Noto Sans (for Lichess-like look) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@400;700&display=swap" rel="stylesheet">

    <!-- Chessground CSS -->
    <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/@lichess-org/chessground@10.0.1/assets/chessground.base.css">
    <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/@lichess-org/chessground@10.0.1/assets/chessground.brown.css">
    <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/@lichess-org/chessground@10.0.1/assets/chessground.cburnett.css">
    <!-- Custom Styles (Overrides) -->
    <link rel="stylesheet" href="style.css?v=3">

    <!-- Tailwind Config -->
    <script src="tailwind-config.js"></script>
</head>

<body class="bg-base-300 min-h-[100dvh] font-sans text-base-content relative">

    <!-- BACKGROUND GRADIENT -->
    <div class="absolute inset-0 bg-gradient-to-br from-base-300 to-base-100 -z-10"></div>

    <!-- ==========================================
         MENU SCREEN
         ========================================== -->
    <main id="startScreen" class="view active w-full min-h-[100dvh] flex flex-col items-center justify-center py-8 px-4">
        <div class="card w-full max-w-2xl bg-base-100/95 shadow-2xl border border-base-content/10 backdrop-blur-md">
            <div class="card-body gap-6 text-center">
                <!-- Header -->
                <div class="pb-2 border-b border-base-content/10">
                    <h1
                        class="text-3xl font-bold bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent inline-flex items-center justify-center">
                        <i class="fa-solid fa-chess-knight mr-2 text-primary"></i>Chess Vision
                    </h1>
                    <p class="text-base-content/60 mt-1">–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ —Ç–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑—Ä–µ–Ω–∏—è</p>
                </div>

                <h2 id="lobby-setup-modal-title" class="sr-only">–ü–∞—Ä–∞–º–µ—Ç—Ä—ã</h2>

                <!-- Main Settings Container (Centered) -->
                <div class="flex flex-col items-center gap-6 w-full max-w-lg mx-auto">

                    <!-- Difficulty -->
                    <div class="form-control w-full">
                        <label class="label font-bold text-sm uppercase text-base-content/70 justify-center pb-2"
                            data-lang="difficulty_label">üéØ –°–ª–æ–∂–Ω–æ—Å—Ç—å</label>
                        <div class="join w-full grid grid-cols-4">
                            <input id="diff_easy" class="join-item btn btn-sm btn-outline" type="radio"
                                name="difficulty" value="easy" aria-label="–õ–µ–≥–∫–æ" data-lang="diff_easy" />
                            <input id="diff_medium" class="join-item btn btn-sm btn-outline" type="radio"
                                name="difficulty" value="medium" checked aria-label="–°—Ä–µ–¥–Ω–µ" data-lang="diff_medium" />
                            <input id="diff_hard" class="join-item btn btn-sm btn-outline" type="radio"
                                name="difficulty" value="hard" aria-label="–°–ª–æ–∂–Ω–æ" data-lang="diff_hard" />
                            <input id="diff_all" class="join-item btn btn-sm btn-outline" type="radio" name="difficulty"
                                value="all" aria-label="–í—Å–µ" data-lang="diff_all" />
                        </div>
                    </div>

                    <!-- Numeric Inputs Section -->
                    <div class="grid grid-cols-2 gap-4 w-full">
                        <!-- Task Count -->
                        <div class="form-control">
                            <label class="label font-bold text-sm uppercase text-base-content/70 justify-center"
                                data-lang="count_label">üß© –ó–∞–¥–∞—á</label>
                            <input id="taskCountInput" type="number" min="1" max="100" value="10"
                                class="input input-bordered input-primary w-full text-center font-mono text-lg" />
                            <div class="label justify-center pt-1 pb-0">
                                <span class="text-xs text-base-content/50">
                                    <span data-lang="available">–î–æ—Å—Ç—É–ø–Ω–æ:</span> <span id="maxPuzzlesCount"
                                        class="font-bold">...</span>
                                </span>
                            </div>
                        </div>

                        <!-- Time Limit -->
                        <div class="form-control">
                            <label class="label font-bold text-sm uppercase text-base-content/70 justify-center"
                                data-lang="time_limit_label">‚è± –í—Ä–µ–º—è (—Å–µ–∫)</label>
                            <input id="timeLimitInput" type="number" min="0" max="600" step="10" value="0"
                                placeholder="0 = –±–µ–∑–ª–∏–º–∏—Ç"
                                class="input input-bordered input-secondary w-full text-center font-mono text-lg" />
                            <label class="label text-xs text-base-content/50 justify-center pt-1"
                                data-lang="unlimited_hint">0 = –±–µ–∑–ª–∏–º–∏—Ç</label>
                        </div>
                    </div>

                    <!-- Settings Toggles (Centered) -->
                    <div class="bg-base-200/50 rounded-box p-6 border border-base-content/5 w-full">
                        <label class="label font-bold text-sm uppercase text-base-content/70 justify-center mb-3"
                            data-lang="settings_title">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</label>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-x-8 gap-y-3 text-left max-w-md mx-auto">
                            <label class="cursor-pointer flex items-center gap-3">
                                <input type="checkbox" id="setGoodMoves" class="toggle toggle-sm toggle-secondary" />
                                <span class="label-text whitespace-nowrap" data-lang="set_good">üö´ –ë–µ–∑ –∑–µ–≤–∫–æ–≤</span>
                            </label>
                            <label class="cursor-pointer flex items-center gap-3">
                                <input type="checkbox" id="setSequential" class="toggle toggle-sm toggle-secondary" />
                                <span class="label-text whitespace-nowrap" data-lang="set_seq">üîÑ –ü–æ–æ—á–µ—Ä–µ–¥–Ω–æ</span>
                            </label>
                            <label class="cursor-pointer flex items-center gap-3">
                                <input type="checkbox" id="setAutoFlip" checked
                                    class="toggle toggle-sm toggle-secondary" />
                                <span class="label-text whitespace-nowrap" data-lang="set_flip">üîÅ –ê–≤—Ç–æ-–ø–æ–≤–æ—Ä–æ—Ç</span>
                            </label>
                            <label class="cursor-pointer flex items-center gap-3">
                                <input type="checkbox" id="setHighlights" checked
                                    class="toggle toggle-sm toggle-secondary" />
                                <span class="label-text whitespace-nowrap" data-lang="set_high">üü© –ü–æ–¥—Å–≤–µ—Ç–∫–∞</span>
                            </label>
                            <label class="cursor-pointer flex items-center gap-3">
                                <input type="checkbox" id="setHints" checked
                                    class="toggle toggle-sm toggle-secondary" />
                                <span class="label-text whitespace-nowrap" data-lang="set_hints">üî¢ –°—á–µ—Ç—á–∏–∫–∏</span>
                            </label>
                            <label class="cursor-pointer flex items-center gap-3">
                                <input type="checkbox" id="setStatusText" checked
                                    class="toggle toggle-sm toggle-secondary" />
                                <span class="label-text whitespace-nowrap" data-lang="set_status">üí¨ –°—Ç–∞—Ç—É—Å—ã</span>
                            </label>
                            <label class="cursor-pointer flex items-center gap-3">
                                <input type="checkbox" id="setShowLog" checked
                                    class="toggle toggle-sm toggle-secondary" />
                                <span class="label-text whitespace-nowrap" data-lang="set_log">üìú –õ–æ–≥ —Ö–æ–¥–æ–≤</span>
                            </label>
                            <label class="cursor-pointer flex items-center gap-3">
                                <input type="checkbox" id="setSound" checked
                                    class="toggle toggle-sm toggle-secondary" />
                                <span class="label-text whitespace-nowrap" data-lang="set_sound">üîä –ó–≤—É–∫–∏</span>
                            </label>
                        </div>

                        <!-- Language Selector -->
                        <div class="divider my-4"></div>
                        <div class="form-control w-full max-w-xs mx-auto">
                            <label class="label font-bold text-sm uppercase text-base-content/70 justify-center mb-2"
                                data-lang="lang_label">üåê –Ø–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞</label>
                            <div class="join w-full grid grid-cols-2">
                                <input class="join-item btn btn-sm btn-outline" type="radio" name="language" value="ru"
                                    aria-label="RU –†—É—Å—Å–∫–∏–π" checked />
                                <input class="join-item btn btn-sm btn-outline" type="radio" name="language" value="en"
                                    aria-label="EN English" />
                            </div>
                        </div>

                        <!-- Theme Selector -->
                        <div class="form-control w-full max-w-xs mx-auto mt-4">
                            <label class="label font-bold text-sm uppercase text-base-content/70 justify-center mb-2"
                                data-lang="set_theme">üé® –¢–µ–º–∞</label>
                            <div class="join w-full grid grid-cols-2">
                                <input class="join-item btn btn-sm btn-outline" type="radio" name="theme" value="light"
                                    aria-label="‚òÄÔ∏è –°–≤–µ—Ç–ª–∞—è" data-lang-aria="theme_light" />
                                <input class="join-item btn btn-sm btn-outline" type="radio" name="theme" value="dark"
                                    aria-label="üåô –¢—ë–º–Ω–∞—è" data-lang-aria="theme_dark" checked />
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Start Button -->
                <div class="card-actions mt-4 justify-center">
                    <button id="startGameBtn"
                        class="btn btn-primary btn-lg w-full max-w-sm shadow-lg hover:scale-[1.01] transition-transform text-lg">
                        <i class="fa-solid fa-play mr-2"></i> <span data-lang="btn_start">–ù–∞—á–∞—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É</span>
                    </button>
                </div>
            </div>
        </div>
        <!-- Dialog wrapper for JS compatibility if needed, but not strictly used by current JS view logic -->
        <dialog class="hidden"></dialog>
    </main>

    <!-- ==========================================
         GAME SCREEN
         ========================================== -->
    <!-- GAME SCREEN -->
    <div id="gameScreen"
        class="view hidden w-full min-h-[100dvh] flex flex-col items-center p-4 pb-20 pt-4 md:pt-8 lg:justify-center">
        <div
            class="flex flex-col lg:flex-row gap-8 lg:gap-12 w-full max-w-[1400px] mx-auto items-center justify-center">

            <!-- CHESS BOARD: width only, aspect-ratio in CSS ensures square -->
            <div class="relative w-[min(90vw,500px)] lg:w-[var(--board-size)] mx-auto lg:mx-0 shadow-2xl rounded-lg board-wrapper">
                <div id="board" class="w-full h-full block"></div>
            </div>

            <!-- SIDEBAR: height matches board via CSS variable -->
            <div class="flex flex-col gap-4 w-full lg:w-[400px] lg:h-[var(--board-size)]">

                <!-- Dashboard Card -->
                <div class="card bg-base-100 shadow-xl border border-base-content/10">
                    <div class="card-body p-4">
                        <h2
                            class="card-title text-sm uppercase text-base-content/50 border-b border-base-content/10 pb-2 justify-center">
                            <i class="fa-solid fa-bullseye text-secondary"></i> <span data-lang="game_title">–ù–∞–π–¥–∏ —à–∞—Ö–∏
                                –∏ –≤–∑—è—Ç–∏—è</span>
                        </h2>

                        <!-- Status & Progress -->
                        <div class="grid grid-cols-2 gap-3 mt-2">
                            <!-- Timer -->
                            <div
                                class="bg-neutral text-neutral-content rounded-xl flex items-center justify-center p-3 font-mono text-2xl font-bold border border-base-content/10 h-14">
                                <i class="fa-regular fa-clock mr-2 text-sm opacity-70"></i>
                                <span id="gameTimer">00:00</span>
                            </div>
                            <!-- Progress -->
                            <div
                                class="bg-base-200 text-base-content rounded-xl flex items-center justify-center p-3 font-mono text-xl font-bold border border-base-content/10 h-14">
                                <span id="progressDisplay">0 / 0</span>
                            </div>
                        </div>

                        <!-- Status + Actions Row (aligned with timer/progress above) -->
                        <div class="grid grid-cols-2 gap-3 mt-3">
                            <!-- Status Message (same width as timer) -->
                            <div class="bg-success/10 text-success rounded-xl p-3 text-center font-bold border border-base-content/10 flex items-center justify-center h-14"
                                id="statusMessage">
                                –£–¥–∞—á–∏!
                            </div>
                            <!-- Buttons (same width as progress) -->
                            <div class="flex gap-2 h-14">
                                <button id="flipBoardBtn"
                                    class="btn btn-ghost rounded-xl flex-1 border border-base-content/10 h-full"
                                    title="–ü–µ—Ä–µ–≤–µ—Ä–Ω—É—Ç—å">
                                    <i class="fa-solid fa-rotate"></i>
                                </button>
                                <button id="giveUpBtn"
                                    class="btn btn-ghost rounded-xl flex-1 border border-error/30 text-error h-full"
                                    title="–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å">
                                    <i class="fa-solid fa-forward-step"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Task Indicator (Sequential Mode) -->
                        <div id="taskIndicator" class="alert alert-warning mt-4 py-2 hidden justify-center">
                            <i class="fa-solid fa-crosshairs"></i>
                            <div>
                                <span class="text-xs uppercase font-bold opacity-70"
                                    data-lang="target_label">–¶–µ–ª—å:</span>
                                <div class="font-bold" id="currentTaskName">White Checks</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Stats Card -->
                <div id="statsContainer"
                    class="card bg-base-100 shadow-xl border border-base-content/10 shrink-0 overflow-hidden">
                    <div class="card-body p-4">
                        <h3
                            class="card-title text-sm uppercase text-base-content/50 border-b border-base-content/10 pb-2 mb-3 justify-center">
                            <i class="fa-solid fa-chart-simple text-primary"></i> <span data-lang="stats_title">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</span>
                        </h3>
                        <!-- Compact table layout -->
                        <div class="grid grid-cols-3 gap-2 text-center">
                            <!-- Header row -->
                            <div></div>
                            <div class="text-xs font-bold text-base-content/50 uppercase" data-lang="col_white">üè≥Ô∏è –ë–µ–ª—ã–µ</div>
                            <div class="text-xs font-bold text-base-content/50 uppercase" data-lang="col_black">üè¥ –ß—ë—Ä–Ω—ã–µ</div>
                            <!-- Checks row -->
                            <div class="text-sm text-left flex items-center">
                                <i class="fa-regular fa-flag text-base-content/60 mr-2"></i>
                                <span data-lang="row_checks">–®–∞—Ö–∏</span>
                            </div>
                            <div class="bg-base-200 rounded-lg p-2">
                                <span id="w-checks" class="badge badge-lg">0/0</span>
                            </div>
                            <div class="bg-base-200 rounded-lg p-2">
                                <span id="b-checks" class="badge badge-lg">0/0</span>
                            </div>
                            <!-- Captures row -->
                            <div class="text-sm text-left flex items-center">
                                <i class="fa-solid fa-xmark text-base-content/60 mr-2"></i>
                                <span data-lang="row_captures">–í–∑—è—Ç–∏—è</span>
                            </div>
                            <div class="bg-base-200 rounded-lg p-2">
                                <span id="w-captures" class="badge badge-lg">0/0</span>
                            </div>
                            <div class="bg-base-200 rounded-lg p-2">
                                <span id="b-captures" class="badge badge-lg">0/0</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Log Container -->
                <div id="logContainer"
                    class="card bg-base-100 shadow-xl border border-base-content/10 flex-1 min-h-48 overflow-hidden">
                    <div class="card-body p-0 flex flex-col h-full">
                        <h3
                            class="card-title text-sm uppercase text-base-content/50 border-b border-base-content/10 p-3 pb-2 justify-center">
                            <i class="fa-solid fa-list-check text-accent"></i> –ù–∞–π–¥–µ–Ω–Ω—ã–µ —Ö–æ–¥—ã
                        </h3>
                        <div class="flex flex-row flex-1 overflow-hidden">
                            <!-- White Log -->
                            <div class="flex-1 bg-base-200/30 p-2 overflow-y-auto border-r border-base-content/10"
                                id="log-white">
                                <div class="text-xs font-bold text-center text-base-content/50 sticky top-0 bg-base-100/90 backdrop-blur w-full py-1 mb-2"
                                    data-lang="white_header">
                                    üè≥Ô∏è –ë–µ–ª—ã–µ</div>
                            </div>
                            <!-- Black Log -->
                            <div class="flex-1 bg-base-200/30 p-2 overflow-y-auto" id="log-black">
                                <div class="text-xs font-bold text-center text-base-content/50 sticky top-0 bg-base-100/90 backdrop-blur w-full py-1 mb-2"
                                    data-lang="black_header">
                                    üè¥ –ß–µ—Ä–Ω—ã–µ</div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <!-- ==========================================
         RESULT SCREEN (–≤—ã–Ω–µ—Å–µ–Ω –∑–∞ –ø—Ä–µ–¥–µ–ª—ã gameScreen)
         ========================================== -->
    <div id="resultScreen" class="view hidden w-full h-[100dvh] flex items-center justify-center p-4 fixed inset-0 bg-base-300 z-50">
        <div class="card w-full max-w-md bg-base-100 shadow-2xl text-center border border-base-content/10">
            <div class="card-body items-center">
                <div
                    class="w-20 h-20 rounded-full bg-success/20 flex items-center justify-center mb-4 text-success text-4xl">
                    <i class="fa-solid fa-trophy"></i>
                </div>
                <h2 class="card-title text-2xl mb-2" data-lang="res_title">üéâ –°–µ—Å—Å–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!</h2>

                <div class="grid grid-cols-2 gap-4 w-full my-4">
                    <div class="flex flex-col items-center bg-base-200 rounded-box p-3">
                        <div class="text-xs uppercase font-bold opacity-60 mb-1" data-lang="res_solved">–†–µ—à–µ–Ω–æ</div>
                        <div class="text-3xl font-bold text-primary" id="resTotalSolved">0</div>
                    </div>
                    <div class="flex flex-col items-center bg-base-200 rounded-box p-3">
                        <div class="text-xs uppercase font-bold opacity-60 mb-1" data-lang="res_time">–í—Ä–µ–º—è</div>
                        <div class="text-3xl font-bold text-secondary font-mono" id="resTotalTime">00:00</div>
                    </div>
                    <div class="flex flex-col items-center bg-base-200 rounded-box p-3">
                        <div class="text-xs uppercase font-bold opacity-60 mb-1" data-lang="res_accuracy">–¢–æ—á–Ω–æ—Å—Ç—å</div>
                        <div class="text-3xl font-bold text-accent font-mono" id="resAccuracy">0%</div>
                    </div>
                    <div class="flex flex-col items-center bg-base-200 rounded-box p-3">
                        <div class="text-xs uppercase font-bold opacity-60 mb-1" data-lang="res_avg">–°—Ä–µ–¥–Ω–µ–µ</div>
                        <div class="text-3xl font-bold text-info font-mono" id="resAvgTime">00:00</div>
                    </div>
                </div>

                <div class="card-actions w-full mt-4">
                    <button id="restartBtn" class="btn btn-primary w-full">
                        <i class="fa-solid fa-rotate-left mr-2"></i> <span data-lang="btn_restart">–ó–∞–Ω–æ–≤–æ</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ==========================================
         TIMEOUT MODAL
         ========================================== -->
    <dialog id="timeoutModal" class="modal modal-bottom sm:modal-middle">
        <div class="modal-box text-center">
            <h3 id="modalTitle" class="font-bold text-lg text-error">
                <i class="fa-solid fa-hourglass-end mr-2"></i> <span data-lang="modal_title">–í—Ä–µ–º—è –≤—ã—à–ª–æ!</span>
            </h3>
            <p class="py-4" data-lang="modal_desc">–õ–∏–º–∏—Ç –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ —Å–µ—Å—Å–∏—é –∏—Å—á–µ—Ä–ø–∞–Ω.</p>
            <div class="modal-action justify-center">
                <form method="dialog">
                    <!-- if there is a button in form, it will close the modal -->
                    <button id="closeModalBtn" class="btn btn-wide" data-lang="modal_btn">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å
                        —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</button>
                </form>
            </div>
        </div>
    </dialog>

    <!-- SCRIPTS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>
    <script type="module" src="dist/main.js"></script>

</body>

</html>